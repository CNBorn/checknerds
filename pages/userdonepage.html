{% extends "base.html" %}
{% block title %} CheckNerds - {{ UserNickName }}已完成项目 {% endblock title %}
		{% block content-holder %}
  		<div id="leftside">
            	<div id="featuredcode2">
                	<div id="featuredcode2-top"></div>
                   	<div id="featuredcode2-mid">
					<h2 class="posttitle" style="font-weight:normal;">{{UserNickName}} &raquo; 已完成的项目</h2>
 
						<table id='mt' cellpadding="0" cellspacing="0" border="0" align="left"><tbody></tbody></table>
						
						<div id="Pagination" class="pagination" style="clear:both; padding-top: 10px;"></div>
						
						<!-- http://www.positioniseverything.net/easyclearing.html --!>
						<div style="clear:both;"></div>

                </div>
                <div id="featuredcode2-bot"></div>
            </div>
			
			<script type="text/javascript">
				//TODO add css ajax table selector: http://yueguangyuan.javaeye.com/blog/241395
				
				var icount;
				var json_userdoneitems;
				function pageselectCallback(page_id, jq){
						var $table = $('#mt');
						$table.children('tbody').empty();
						$table.children('tbody').append('<tr><th colspan="2" class="viewitem_title">&nbsp; 共有' + icount.toString() + '个已完成项目</th></tr><tr><th width="70%" class="viewitem_tags">名称</th><th class="viewitem_tags">添加日期</th></tr>');

						//http://liuyami.com/archives/14.html
						for(var i=((page_id*15)+0); i<((page_id*15)+14); i++)
						{
							try
							{
								var dispstr = '<tr colspan="2"><td class="viewitem_creator"><img src="/img/accept16.png">' + '<a href="/i/' + json_userdoneitems[i].id + '">' + json_userdoneitems[i].name + '</a>&nbsp;';
								dispstr = dispstr + '<a onclick="ajax_undoneItem(' + "'/undoneItem/" + json_userdoneitems[i].id + "');" + '" href="#;" class="x">撤销</a>'; 
								dispstr = dispstr + '<br />' + json_userdoneitems[i].comment + '</td><td>' + json_userdoneitems[i].date + '</td></tr>';
								
								//ideas inspired by http://www.packtpub.com/article/jquery-table-manipulation-part1
								$table.children('tbody').append(dispstr);
							}
							catch(err){}
						}
                
					$("#mt tr:odd style").backgroundColor='#000000';
					$("#mt tr:not(:has('th'))").mouseover(function(ev){  
						this.style.backgroundColor='#FEFEFE';
					});  
					$("#mt tr:not(:has('th'))").mouseout(function(ev){  
						this.style.backgroundColor='';  
					});  
				
				
				}
			
            	window.onload = function() {
					//http://bbs.jquery.org.cn/viewthread.php?tid=1739
					$.ajaxSetup({async:false});
					
					
					$.getJSON("/ajax/getjson_userdoneitems",function(json){
						icount = json.length;
						json_userdoneitems = json;
					});

					// Create pagination element					
					$("#Pagination").pagination(icount, {
						num_edge_entries: 1,
						items_per_page: 15,
						num_display_entries: 10,
						prev_text: '上一页',
						next_text: '下一页',
						callback: pageselectCallback
                	});					
					pageselectCallback(0,$("#Pagination")); //show the first page.
				}

				function ajax_undoneItem(strLink){
                	$.ajax({type: "GET", url: strLink ,success: function(){location.reload();}});
                    return false; 
				}

   			</script>
        {% endblock content-holder %}
